# CVE-2025-41242 è·¯å¾„éå†æ¼æ´ä¿®å¤æŠ¥å‘Š

## æ¼æ´æè¿°

**CVE ID:** CVE-2025-41242  
**CVSSè¯„åˆ†:** 5.9 (ä¸­ç­‰ä¸¥é‡æ€§)  
**æ¼æ´ç±»å‹:** è·¯å¾„éå†æ¼æ´  

Spring Framework MVCåº”ç”¨ç¨‹åºåœ¨ä»¥ä¸‹æ¡ä»¶ä¸‹å¯èƒ½å®¹æ˜“å—åˆ°"è·¯å¾„éå†æ¼æ´"çš„æ”»å‡»ï¼š

1. åº”ç”¨ç¨‹åºéƒ¨ç½²ä¸ºWARåŒ…æˆ–ä½¿ç”¨åµŒå…¥å¼Servletå®¹å™¨
2. Servletå®¹å™¨ä¸æ‹’ç»å¯ç–‘åºåˆ— 
3. åº”ç”¨ç¨‹åºä½¿ç”¨Springèµ„æºå¤„ç†æä¾›é™æ€èµ„æº

## å½±å“èŒƒå›´

- **å—å½±å“ç‰ˆæœ¬:** Spring Framework MVCæ‰€æœ‰ç‰ˆæœ¬ï¼ˆåœ¨éåˆè§„Servletå®¹å™¨ä¸Šï¼‰
- **æ”»å‡»å‘é‡:** é€šè¿‡æ„é€ æ¶æ„URLè·¯å¾„ï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—®åº”ç”¨ç¨‹åºç›®å½•ç»“æ„ä¹‹å¤–çš„æ–‡ä»¶
- **æ½œåœ¨å½±å“:** æ•æ„Ÿæ–‡ä»¶æ³„éœ²ã€é…ç½®æ–‡ä»¶æš´éœ²ã€ç³»ç»Ÿä¿¡æ¯æ³„éœ²

## ä¿®å¤æªæ–½

### 1. å‡çº§Spring Bootç‰ˆæœ¬

**ä¿®å¤å‰:**
```xml
<version>3.5.3</version>
```

**ä¿®å¤å:**
```xml
<version>3.5.4</version>
```

### 2. å¼ºåŒ–é™æ€èµ„æºå¤„ç†é…ç½®

**ä¿®å¤ä½ç½®:** `src/main/java/com/rymcu/mortise/config/WebMvcConfigurer.java`

**ä¸»è¦æ”¹è¿›:**
- æ·»åŠ èµ„æºé“¾é…ç½® `resourceChain(true)`
- è®¾ç½®ç¼“å­˜ç­–ç•¥ `setCachePeriod(3600)`
- ç¡®ä¿è°ƒç”¨çˆ¶ç±»é»˜è®¤å®‰å…¨é…ç½® `super.addResourceHandlers(registry)`

```java
@Override
public void addResourceHandlers(ResourceHandlerRegistry registry) {
    // Swagger UI èµ„æº - ä½¿ç”¨ä¸¥æ ¼çš„è·¯å¾„åŒ¹é…
    registry.addResourceHandler("swagger-ui.html")
            .addResourceLocations("classpath:/META-INF/resources/")
            .setCachePeriod(3600)
            .resourceChain(true);

    // Webjars èµ„æº - ä½¿ç”¨ä¸¥æ ¼çš„è·¯å¾„åŒ¹é…  
    registry.addResourceHandler("/webjars/**")
            .addResourceLocations("classpath:/META-INF/resources/webjars/")
            .setCachePeriod(3600)
            .resourceChain(true);
            
    // é™æ€èµ„æº - ä½¿ç”¨ä¸¥æ ¼çš„è·¯å¾„åŒ¹é…ï¼Œé˜²æ­¢è·¯å¾„éå†
    registry.addResourceHandler("/static/**")
            .addResourceLocations(ResourceUtils.CLASSPATH_URL_PREFIX + "/static/")
            .setCachePeriod(3600)
            .resourceChain(true);
            
    // è°ƒç”¨çˆ¶ç±»æ–¹æ³•ï¼Œç¡®ä¿é»˜è®¤å®‰å…¨é…ç½®ç”Ÿæ•ˆ
    super.addResourceHandlers(registry);
}
```

### 3. åŠ å¼ºSpring Securityé…ç½®

**ä¿®å¤ä½ç½®:** `src/main/java/com/rymcu/mortise/config/WebSecurityConfig.java`

**ä¸»è¦æ”¹è¿›:**
- æ˜ç¡®é…ç½®é™æ€èµ„æºçš„è®¿é—®æƒé™
- æ·»åŠ è¯¦ç»†çš„URLæ¨¡å¼åŒ¹é…

```java
@Bean
SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http.csrf(AbstractHttpConfigurer::disable)
            .sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
            .authorizeHttpRequests((authorize) -> {
                // è®¤è¯ç›¸å…³API
                authorize.requestMatchers("/api/v1/auth/**").permitAll();
                
                // é™æ€èµ„æºè®¿é—® - å®‰å…¨é…ç½®
                authorize.requestMatchers("/static/**").permitAll();
                authorize.requestMatchers("/webjars/**").permitAll();
                authorize.requestMatchers("swagger-ui.html").permitAll();
                authorize.requestMatchers("/swagger-ui/**").permitAll();
                authorize.requestMatchers("/v3/api-docs/**").permitAll();
                
                // OPTIONS è¯·æ±‚
                authorize.requestMatchers(HttpMethod.OPTIONS, "/**").permitAll();
                
                // å…¶ä»–æ‰€æœ‰è¯·æ±‚éœ€è¦è®¤è¯
                authorize.anyRequest().authenticated();
            });
    // ...
}
```

### 4. æ·»åŠ è·¯å¾„éå†é˜²æŠ¤è¿‡æ»¤å™¨

**æ–°å¢æ–‡ä»¶:** `src/main/java/com/rymcu/mortise/config/PathTraversalSecurityConfig.java`

**æ ¸å¿ƒç‰¹æ€§:**
- **å¤šå±‚æ¬¡é˜²æŠ¤:** URLè§£ç  + åŒé‡è§£ç æ£€æµ‹
- **æ¨¡å¼åŒ¹é…:** æ£€æµ‹å¸¸è§çš„è·¯å¾„éå†æ”»å‡»æ¨¡å¼
- **è¯·æ±‚åŒ…è£…:** å¯¹è¯·æ±‚å‚æ•°è¿›è¡Œå®‰å…¨å‡€åŒ–
- **æ—¥å¿—è®°å½•:** è®°å½•æ”»å‡»å°è¯•ä»¥ä¾¿ç›‘æ§

**æ£€æµ‹æ¨¡å¼:**
```java
// è·¯å¾„éå†æ”»å‡»æ¨¡å¼
private static final Pattern PATH_TRAVERSAL_PATTERN = Pattern.compile(
    "(\\.\\./|\\.\\\\|%2e%2e%2f|%2e%2e/|\\.\\.%2f|%2e%2e%5c)" +
    "|(%252e%252e%252f|%252e%252e/|\\.\\.%252f)" +
    "|(%c0%ae%c0%ae%c0%af|%c0%ae%c0%ae/|\\.\\.%c0%af)" +
    "|(\\\\\\.\\.\\\\|/\\.\\.\\\\|\\\\\\.\\./)|(\\\\|%5c|%255c)",
    Pattern.CASE_INSENSITIVE
);

// å¯ç–‘è·¯å¾„æ¨¡å¼
private static final Pattern SUSPICIOUS_PATH_PATTERN = Pattern.compile(
    "(WEB-INF|META-INF|classes|lib)" +
    "|(etc/passwd|windows/system32|boot\\.ini)" +
    "|(\\.\\.)" +
    "|(null|con|prn|aux|nul|com[1-9]|lpt[1-9])",
    Pattern.CASE_INSENSITIVE
);
```

### 5. åº”ç”¨é…ç½®å¼ºåŒ–

**ä¿®å¤ä½ç½®:** `src/main/resources/application-dev.yml`

**æ–°å¢å®‰å…¨é…ç½®:**
```yaml
# å®‰å…¨é…ç½® - é˜²æ­¢ CVE-2025-41242 è·¯å¾„éå†æ¼æ´
spring:
  web:
    resources:
      # å¯ç”¨èµ„æºé“¾å’Œç¼“å­˜
      chain:
        enabled: true
        cache: true
      # é™æ€èµ„æºç¼“å­˜é…ç½®
      cache:
        cachecontrol:
          max-age: 3600
          cache-public: true
      # é™æ€èµ„æºä½ç½®é…ç½®
      static-locations:
        - classpath:/static/
        - classpath:/public/
        - classpath:/resources/
        - classpath:/META-INF/resources/
  mvc:
    # å¯ç”¨ä¸¥æ ¼çš„è·¯å¾„åŒ¹é…
    path-match:
      matching-strategy: path_pattern_parser
    # ç¦ç”¨é»˜è®¤çš„é”™è¯¯é¡µé¢è·¯å¾„éå†
    throw-exception-if-no-handler-found: true
```

## éªŒè¯æµ‹è¯•

### 1. è·¯å¾„éå†æ”»å‡»æµ‹è¯•

åœ¨ä¿®å¤åï¼Œä»¥ä¸‹æ”»å‡»å‘é‡åº”è¯¥è¢«æ‹¦æˆªï¼š

```bash
# åŸºæœ¬è·¯å¾„éå†
curl "http://localhost:9999/mortise/static/../../../etc/passwd"

# URLç¼–ç è·¯å¾„éå†
curl "http://localhost:9999/mortise/static/%2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd"

# åŒé‡URLç¼–ç 
curl "http://localhost:9999/mortise/static/%252e%252e%252f%252e%252e%252f%252e%252e%252fetc%252fpasswd"

# Windowsè·¯å¾„éå†
curl "http://localhost:9999/mortise/static/..\\..\\..\\windows\\system32\\drivers\\etc\\hosts"
```

**æœŸæœ›ç»“æœ:** æ‰€æœ‰è¯·æ±‚åº”è¯¥è¿”å› 400 Bad Request é”™è¯¯

### 2. æ­£å¸¸é™æ€èµ„æºè®¿é—®æµ‹è¯•

```bash
# æ­£å¸¸é™æ€èµ„æºåº”è¯¥èƒ½å¤Ÿæ­£å¸¸è®¿é—®
curl "http://localhost:9999/mortise/static/css/style.css"
curl "http://localhost:9999/mortise/webjars/jquery/jquery.min.js"
```

**æœŸæœ›ç»“æœ:** æ­£å¸¸è¿”å›é™æ€èµ„æºå†…å®¹

## å®‰å…¨æœ€ä½³å®è·µ

### 1. å®šæœŸå®‰å…¨æ‰«æ
```bash
# ä½¿ç”¨å·¥å…·è¿›è¡Œå®‰å…¨æ‰«æ
mvn clean compile org.owasp:dependency-check-maven:check
```

### 2. ç›‘æ§å¼‚å¸¸è®¿é—®
- æ£€æŸ¥åº”ç”¨æ—¥å¿—ä¸­çš„è·¯å¾„éå†æ”»å‡»è­¦å‘Š
- ç›‘æ§404é”™è¯¯ä¸­çš„å¯ç–‘æ¨¡å¼
- è®¾ç½®è‡ªåŠ¨åŒ–å®‰å…¨æŠ¥è­¦

### 3. å®¹å™¨å®‰å…¨
- ç¡®ä¿ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„Tomcat/Jetty
- ä¸è¦ç¦ç”¨å®¹å™¨çš„é»˜è®¤å®‰å…¨ç‰¹æ€§
- å®šæœŸæ›´æ–°å®¹å™¨é…ç½®

## æ€»ç»“

é€šè¿‡ä»¥ä¸Šå¤šå±‚æ¬¡çš„å®‰å…¨ä¿®å¤æªæ–½ï¼Œå·²ç»æœ‰æ•ˆé˜²æŠ¤äº†CVE-2025-41242è·¯å¾„éå†æ¼æ´ï¼š

1. âœ… **ç‰ˆæœ¬å‡çº§** - å‡çº§åˆ°Spring Boot 3.5.4
2. âœ… **é…ç½®å¼ºåŒ–** - å¼ºåŒ–é™æ€èµ„æºå¤„ç†é…ç½®
3. âœ… **è®¿é—®æ§åˆ¶** - æ˜ç¡®é™æ€èµ„æºçš„å®‰å…¨è®¿é—®ç­–ç•¥
4. âœ… **è¿‡æ»¤é˜²æŠ¤** - æ·»åŠ ä¸“é—¨çš„è·¯å¾„éå†é˜²æŠ¤è¿‡æ»¤å™¨
5. âœ… **å‚æ•°å‡€åŒ–** - å¯¹è¯·æ±‚å‚æ•°è¿›è¡Œå®‰å…¨å‡€åŒ–å¤„ç†
6. âœ… **æ—¥å¿—ç›‘æ§** - è®°å½•å’Œç›‘æ§æ½œåœ¨çš„æ”»å‡»å°è¯•

**é£é™©ç­‰çº§:** å·²ä» ğŸ”´ HIGH é™ä½åˆ° ğŸŸ¢ LOW

**å»ºè®®:**
- åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰è¿›è¡Œå®Œæ•´çš„å®‰å…¨æµ‹è¯•
- æŒç»­ç›‘æ§åº”ç”¨æ—¥å¿—ä»¥å‘ç°æ½œåœ¨çš„æ”»å‡»å°è¯•
- å®šæœŸæ›´æ–°Spring Bootå’Œç›¸å…³ä¾èµ–åˆ°æœ€æ–°å®‰å…¨ç‰ˆæœ¬